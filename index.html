<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Pedidos Toyo MX</title>
  <meta name="theme-color" content="#0B4CCB" />
  <style>
    :root{
      --blue:#0B4CCB;
      --bg:#F3F5F7;
      --card:#ffffff;
      --border:#D1D5DB;
      --text:#111827;
      --muted:#6b7280;
      --shadow:0 10px 28px rgba(0,0,0,.08);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:linear-gradient(180deg,#f7f9ff 0%, var(--bg) 100%);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 14px 90px}
    .top{
      position:sticky; top:0; z-index:50;
      background:rgba(243,245,247,.76);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(17,24,39,.08);
    }
    .topin{max-width:1100px;margin:0 auto;padding:12px 14px;display:flex;align-items:center;gap:12px;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:40px;height:40px;border-radius:14px;
      background:linear-gradient(135deg,#083aa0,#0B4CCB 60%, #8fb3ff);
      box-shadow:0 10px 22px rgba(11,76,203,.25);
    }
    h1{font-size:20px;margin:0;color:var(--blue);letter-spacing:.2px}
    .sub{font-size:13px;color:var(--muted);margin-top:2px}
    .pill{
      display:inline-flex;gap:8px;align-items:center;
      background:#eef4ff;border:1px solid #c7dbff;color:var(--blue);
      padding:9px 12px;border-radius:999px;font-weight:800;font-size:12px;
      white-space:nowrap;
    }
    .content{padding-top:14px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;align-items:start}
    @media(max-width:980px){ .grid{grid-template-columns:1fr} }
    .card{
      background:var(--card);
      border:1px solid rgba(17,24,39,.10);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hd{padding:16px 16px 12px;border-bottom:1px solid rgba(17,24,39,.08);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .title{font-weight:900}
    .bd{padding:14px 16px 16px}
    label{display:block;font-weight:900;font-size:12px;color:#0b3c91;margin-bottom:6px}
    input,select{
      width:100%; padding:13px 14px; border-radius:14px;
      border:1px solid var(--border); font-size:15px;
      background:#fff;
    }
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:220px}
    .note{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.35}
    .btnbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      border:1px solid rgba(17,24,39,.12);
      background:#fff;
      padding:11px 14px;border-radius:14px;
      font-weight:900;cursor:pointer;
    }
    .btn.primary{background:var(--blue);color:#fff;border-color:transparent}
    .btn.ghost{background:#f8fafc}
    .stats{display:flex;gap:10px;flex-wrap:wrap}
    .stat{
      background:#f8fafc;border:1px solid rgba(17,24,39,.08);
      padding:10px 12px;border-radius:14px;
      font-size:12px;color:var(--muted)
    }
    .stat b{color:var(--text);font-size:14px}
    .list{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:720px){ .list{grid-template-columns:1fr} }
    .item{
      border:1px solid rgba(17,24,39,.10);
      border-radius:16px;
      padding:14px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:#fff;
    }
    .name{font-weight:950}
    .meta{font-size:12px;color:var(--muted);margin-top:4px}
    .open{background:#eef4ff;border:1px solid #c7dbff;color:var(--blue);padding:10px 12px;border-radius:14px;font-weight:950;cursor:pointer;white-space:nowrap}
    .fav{
      width:40px;height:40px;border-radius:14px;
      border:1px solid rgba(17,24,39,.12);
      display:grid;place-items:center;cursor:pointer;
      background:#fff;
    }
    .fav.on{background:#fff7ed;border-color:#fed7aa}
    .muted{color:var(--muted)}
    .empty{
      padding:14px;border:1px dashed rgba(17,24,39,.18);border-radius:16px;
      color:var(--muted);background:#fff;grid-column:1/-1
    }
    /* Bottom nav */
    .nav{
      position:fixed;left:0;right:0;bottom:0;z-index:60;
      background:rgba(255,255,255,.86);
      backdrop-filter: blur(10px);
      border-top:1px solid rgba(17,24,39,.10);
    }
    .navin{max-width:1100px;margin:0 auto;padding:10px 14px;display:flex;gap:10px;justify-content:space-between}
    .tab{
      flex:1;
      border:1px solid rgba(17,24,39,.10);
      background:#fff;
      padding:10px 12px;border-radius:16px;
      display:flex;align-items:center;justify-content:center;gap:8px;
      font-weight:900;cursor:pointer;
      color:var(--muted);
    }
    .tab.active{color:#fff;background:var(--blue);border-color:transparent;box-shadow:0 10px 20px rgba(11,76,203,.22)}
    .mini{font-size:11px}
    .skeleton{
      height:58px;border-radius:16px;
      background:linear-gradient(90deg,#f1f5f9 25%,#e5e7eb 37%,#f1f5f9 63%);
      background-size:400% 100%;
      animation:shimmer 1.2s infinite;
      border:1px solid rgba(17,24,39,.06)
    }
    @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      padding:7px 10px;border-radius:999px;
      background:#f8fafc;border:1px solid rgba(17,24,39,.10);
      font-weight:900;font-size:12px;color:var(--muted);cursor:pointer;
    }
    .chip.active{background:#eef4ff;border-color:#c7dbff;color:var(--blue)}
  </style>
</head>
<body>
  <header class="top">
    <div class="topin">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Pedidos Toyo MX</h1>
          <div class="sub">Buscador general por cliente ¬∑ GitHub Pages</div>
        </div>
      </div>
      <div class="pill" id="pillStatus">Cargando‚Ä¶</div>
    </div>
  </header>

  <main class="wrap">
    <div class="content grid">
      <!-- Left -->
      <section class="card">
        <div class="hd">
          <div class="title" id="panelTitle">Clientes</div>
          <div class="stats" id="stats">
            <div class="stat"><b id="stClients">‚Äî</b><div>clientes</div></div>
            <div class="stat"><b id="stVendors">‚Äî</b><div>vendedores</div></div>
          </div>
        </div>
        <div class="bd">
          <div id="panelClientes">
            <div class="row">
              <div class="col">
                <label>Buscar cliente (nombre o c√≥digo)</label>
                <input id="q" placeholder="Ej. ALTAMESE o C020669" autocomplete="off" />
                <div class="note">Tip: pega el c√≥digo y abre el HTML directo.</div>
              </div>
              <div class="col">
                <label>Filtrar por vendedor</label>
                <select id="vendorSel">
                  <option value="ALL">Todos</option>
                </select>
                <div class="note">Este index lee <b>clients.json</b> en la ra√≠z del repo.</div>
              </div>
            </div>

            <div class="btnbar">
              <button class="btn primary" id="btnAll">Ver todos</button>
              <button class="btn ghost" id="btnClear">Limpiar</button>
              <button class="btn" id="btnDiag">Diagn√≥stico</button>
            </div>

            <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:14px 0"></div>

            <div class="list" id="list">
              <div class="skeleton"></div>
              <div class="skeleton"></div>
              <div class="skeleton"></div>
              <div class="skeleton"></div>
            </div>
          </div>

          <div id="panelVendedores" style="display:none">
            <div class="chips" id="vendorChips"></div>
            <div class="note" style="margin-top:10px">Toca un vendedor para ver sus clientes.</div>
            <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:14px 0"></div>
            <div class="list" id="vendorList"></div>
          </div>

          <div id="panelRecientes" style="display:none">
            <div class="note">Aqu√≠ aparecen los √∫ltimos clientes que abriste (en este dispositivo).</div>
            <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:14px 0"></div>
            <div class="list" id="recentList"></div>
          </div>

          <div id="panelFavs" style="display:none">
            <div class="note">Marca ‚≠ê para guardar clientes favoritos (en este dispositivo).</div>
            <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:14px 0"></div>
            <div class="list" id="favList"></div>
          </div>

          <div id="panelDiag" style="display:none">
            <div class="note">Si no aparecen clientes, aqu√≠ te dice por qu√©.</div>
            <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:14px 0"></div>
            <div class="card" style="box-shadow:none;border-radius:16px">
              <div class="bd">
                <div class="mini muted">URL detectada de clients.json</div>
                <div style="font-weight:900;margin-top:6px" id="diagUrl">‚Äî</div>
                <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:12px 0"></div>
                <div class="mini muted">Resultado</div>
                <pre id="diagOut" style="white-space:pre-wrap;margin:6px 0 0;background:#0f172a;color:#e5e7eb;padding:12px;border-radius:14px;overflow:auto"></pre>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- Right -->
      <aside class="card">
        <div class="hd">
          <div class="title">Accesos r√°pidos</div>
          <div class="pill" style="background:#f8fafc;border-color:rgba(17,24,39,.10);color:var(--muted)">App style</div>
        </div>
        <div class="bd">
          <div class="note">
            ‚Ä¢ Para que siempre cargue lo nuevo, abre con <b>?v=2</b> (cambia el n√∫mero cuando actualices).<br>
            ‚Ä¢ Si abres un cliente y da 404, normalmente es porque el <b>nombre del archivo</b> no coincide con el path.
          </div>

          <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:14px 0"></div>

          <div class="stats">
            <div class="stat"><b id="stShown">‚Äî</b><div>mostrados</div></div>
            <div class="stat"><b id="stFav">‚Äî</b><div>favoritos</div></div>
            <div class="stat"><b id="stRec">‚Äî</b><div>recientes</div></div>
          </div>

          <div class="hr" style="height:1px;background:rgba(17,24,39,.08);margin:14px 0"></div>

          <div class="btnbar">
            <button class="btn" id="btnOpenClientsJson">Abrir clients.json</button>
            <button class="btn" id="btnHardReload">Refrescar (sin cach√©)</button>
          </div>

          <div class="note" style="margin-top:10px">
            Sugerencia: comparte links directos as√≠:<br>
            <span style="font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace">
              /carpeta/cliente_codigo.html
            </span>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <nav class="nav">
    <div class="navin">
      <button class="tab active" data-tab="clientes">üîé <span>Clientes</span></button>
      <button class="tab" data-tab="vendedores">üßë‚Äçüíº <span>Vendedores</span></button>
      <button class="tab" data-tab="recientes">üïò <span>Recientes</span></button>
      <button class="tab" data-tab="favs">‚≠ê <span>Favoritos</span></button>
    </div>
  </nav>

<script>
(() => {
  const qs = new URLSearchParams(location.search);
  const bust = qs.get("v") || String(Date.now()); // si no pones ?v=, cache-bust autom√°tico
  const base = location.pathname.replace(/\/+$/,"/"); // .../Toyo-MX/
  const CLIENTS_URL = base + "clients.json?v=" + encodeURIComponent(bust);

  const $ = (id)=>document.getElementById(id);

  const pillStatus = $("pillStatus");
  const q = $("q");
  const vendorSel = $("vendorSel");
  const list = $("list");
  const stClients = $("stClients");
  const stVendors = $("stVendors");
  const stShown = $("stShown");
  const stFav = $("stFav");
  const stRec = $("stRec");

  const panelTitle = $("panelTitle");
  const panelClientes = $("panelClientes");
  const panelVendedores = $("panelVendedores");
  const panelRecientes = $("panelRecientes");
  const panelFavs = $("panelFavs");
  const panelDiag = $("panelDiag");

  const vendorChips = $("vendorChips");
  const vendorList = $("vendorList");
  const recentList = $("recentList");
  const favList = $("favList");

  const diagUrl = $("diagUrl");
  const diagOut = $("diagOut");

  const KEY_FAV = "toyo_mx_favs_v1";
  const KEY_REC = "toyo_mx_recent_v1";

  let clients = [];
  let filtered = [];

  function normalize(s){
    return (s||"").toString().trim().toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"");
  }

  function loadArr(key){
    try{ return JSON.parse(localStorage.getItem(key)||"[]"); }catch(e){ return []; }
  }
  function saveArr(key, arr){
    localStorage.setItem(key, JSON.stringify(arr||[]));
  }
  function getFavs(){ return new Set(loadArr(KEY_FAV)); }
  function toggleFav(id){
    const favs = loadArr(KEY_FAV);
    const idx = favs.indexOf(id);
    if(idx>=0) favs.splice(idx,1); else favs.push(id);
    saveArr(KEY_FAV, favs);
    renderMeta();
    renderLists();
  }
  function pushRecent(id){
    const rec = loadArr(KEY_REC).filter(x=>x!==id);
    rec.unshift(id);
    saveArr(KEY_REC, rec.slice(0,30));
    renderMeta();
  }

  function makeId(c){
    return (c.vendor_folder||"") + "|" + (c.client_code||"") + "|" + (c.path||"");
  }

  function openClient(c){
    if(!c || !c.path) return;
    pushRecent(makeId(c));
    // abrir en la misma pesta√±a para m√≥vil (mejor UX). Cambia a window.open(...) si quieres.
    location.href = base + c.path;
  }

  function uniqueVendors(arr){
    const map = new Map();
    arr.forEach(c=>{
      const k = c.vendor_folder || "sin_vendedor";
      if(!map.has(k)){
        map.set(k, {
          folder:k,
          label:c.vendor_label || k,
          count:0
        });
      }
      map.get(k).count++;
    });
    return [...map.values()].sort((a,b)=> a.label.localeCompare(b.label));
  }

  function renderMeta(){
    stClients.textContent = clients.length.toLocaleString("es-MX");
    stVendors.textContent = uniqueVendors(clients).length.toLocaleString("es-MX");
    stShown.textContent = filtered.length.toLocaleString("es-MX");
    stFav.textContent = loadArr(KEY_FAV).length.toLocaleString("es-MX");
    stRec.textContent = loadArr(KEY_REC).length.toLocaleString("es-MX");
  }

  function cardHtml(c){
    const id = makeId(c);
    const favs = getFavs();
    const isFav = favs.has(id);
    return `
      <div class="item">
        <div style="min-width:0">
          <div class="name" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${escapeHtml(c.client_name || "‚Äî")}</div>
          <div class="meta">${escapeHtml(c.client_code || "‚Äî")} ¬∑ <span class="muted">${escapeHtml(c.vendor_label || c.vendor_folder || "‚Äî")}</span></div>
        </div>
        <div style="display:flex;gap:10px;align-items:center;flex:0 0 auto">
          <button class="fav ${isFav?"on":""}" title="Favorito" data-fav="${encodeAttr(id)}">${isFav?"‚≠ê":"‚òÜ"}</button>
          <button class="open" data-open="${encodeAttr(id)}">Abrir</button>
        </div>
      </div>
    `;
  }

  function escapeHtml(s){
    return (s ?? "").toString()
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }
  function encodeAttr(s){
    return encodeURIComponent(s||"");
  }
  function decodeAttr(s){
    try{ return decodeURIComponent(s||""); }catch(e){ return s; }
  }

  function renderClientsList(){
    if(!filtered.length){
      list.innerHTML = `<div class="empty">Sin resultados. Prueba buscar por <b>c√≥digo</b> o cambia el vendedor.</div>`;
      return;
    }
    const slice = filtered.slice(0, 600); // evita DOM enorme
    list.innerHTML = slice.map(cardHtml).join("") + (filtered.length>slice.length ? `<div class="empty">Mostrando ${slice.length} de ${filtered.length}. Usa b√∫squeda o filtro para acotar.</div>`:"");
    bindCardButtons(list, slice);
  }

  function bindCardButtons(container, arr){
    const byId = new Map(arr.map(c=>[makeId(c), c]));
    container.querySelectorAll("[data-open]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = decodeAttr(btn.getAttribute("data-open"));
        openClient(byId.get(id));
      });
    });
    container.querySelectorAll("[data-fav]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = decodeAttr(btn.getAttribute("data-fav"));
        toggleFav(id);
      });
    });
  }

  function applyFilters(){
    const text = normalize(q.value);
    const v = vendorSel.value || "ALL";
    filtered = clients.filter(c=>{
      if(v!=="ALL" && (c.vendor_folder||"")!==v) return false;
      if(!text) return true;
      return normalize(c.client_name).includes(text) || normalize(c.client_code).includes(text);
    });
    renderMeta();
    renderClientsList();
  }

  function fillVendorSelect(){
    const vs = uniqueVendors(clients);
    vendorSel.innerHTML = `<option value="ALL">Todos</option>` + vs.map(v=>`<option value="${escapeHtml(v.folder)}">${escapeHtml(v.label)} (${v.count})</option>`).join("");
  }

  function renderVendorsPanel(){
    const vs = uniqueVendors(clients);
    vendorChips.innerHTML = vs.map((v,i)=>`<button class="chip" data-chip="${escapeHtml(v.folder)}">${escapeHtml(v.label)} <span class="mini">(${v.count})</span></button>`).join("");
    vendorList.innerHTML = `<div class="empty">Toca un vendedor arriba para ver su lista.</div>`;

    vendorChips.querySelectorAll("[data-chip]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        vendorChips.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
        btn.classList.add("active");
        const folder = btn.getAttribute("data-chip");
        const arr = clients.filter(c=>(c.vendor_folder||"")===folder);
        vendorList.innerHTML = arr.slice(0, 600).map(cardHtml).join("") + (arr.length>600?`<div class="empty">Mostrando 600 de ${arr.length}. Usa b√∫squeda en ‚ÄúClientes‚Äù si necesitas uno espec√≠fico.</div>`:"");
        bindCardButtons(vendorList, arr.slice(0,600));
      });
    });
  }

  function renderRecentPanel(){
    const ids = loadArr(KEY_REC);
    const map = new Map(clients.map(c=>[makeId(c), c]));
    const arr = ids.map(id=>map.get(id)).filter(Boolean);
    if(!arr.length){
      recentList.innerHTML = `<div class="empty">A√∫n no has abierto clientes en este dispositivo.</div>`;
      return;
    }
    recentList.innerHTML = arr.map(cardHtml).join("");
    bindCardButtons(recentList, arr);
  }

  function renderFavsPanel(){
    const favs = loadArr(KEY_FAV);
    const map = new Map(clients.map(c=>[makeId(c), c]));
    const arr = favs.map(id=>map.get(id)).filter(Boolean);
    if(!arr.length){
      favList.innerHTML = `<div class="empty">No tienes favoritos. Marca ‚≠ê en cualquier cliente.</div>`;
      return;
    }
    favList.innerHTML = arr.map(cardHtml).join("");
    bindCardButtons(favList, arr);
  }

  function renderLists(){
    // re-render panel actual
    if(panelClientes.style.display!=="none"){ renderClientsList(); }
    if(panelVendedores.style.display!=="none"){ renderVendorsPanel(); }
    if(panelRecientes.style.display!=="none"){ renderRecentPanel(); }
    if(panelFavs.style.display!=="none"){ renderFavsPanel(); }
  }

  function setTab(tab){
    document.querySelectorAll(".tab").forEach(b=>b.classList.toggle("active", b.dataset.tab===tab));
    panelClientes.style.display = (tab==="clientes") ? "" : "none";
    panelVendedores.style.display = (tab==="vendedores") ? "" : "none";
    panelRecientes.style.display = (tab==="recientes") ? "" : "none";
    panelFavs.style.display = (tab==="favs") ? "" : "none";
    panelDiag.style.display = "none";

    panelTitle.textContent =
      tab==="clientes" ? "Clientes" :
      tab==="vendedores" ? "Vendedores" :
      tab==="recientes" ? "Recientes" :
      "Favoritos";

    // render
    if(tab==="clientes"){ applyFilters(); }
    if(tab==="vendedores"){ renderVendorsPanel(); }
    if(tab==="recientes"){ renderRecentPanel(); }
    if(tab==="favs"){ renderFavsPanel(); }
  }

  async function runDiag(err){
    diagUrl.textContent = CLIENTS_URL;
    const out = {
      clients_url: CLIENTS_URL,
      base_path: base,
      error: err ? (err.message || String(err)) : null,
      hint: "Verifica que clients.json est√© en la RA√çZ del repo (misma altura que index.html)."
    };
    diagOut.textContent = JSON.stringify(out, null, 2);
    panelClientes.style.display="none";
    panelVendedores.style.display="none";
    panelRecientes.style.display="none";
    panelFavs.style.display="none";
    panelDiag.style.display="";
    panelTitle.textContent="Diagn√≥stico";
  }

  async function load(){
    pillStatus.textContent = "Cargando‚Ä¶";
    try{
      const res = await fetch(CLIENTS_URL, {cache:"no-store"});
      if(!res.ok) throw new Error("No se pudo cargar clients.json (HTTP "+res.status+")");
      const data = await res.json();
      if(!Array.isArray(data)) throw new Error("clients.json no es un array JSON");
      clients = data.map(c=>({
        vendor_folder: (c.vendor_folder||"").toString().trim(),
        vendor_label: (c.vendor_label||c.vendor_folder||"").toString().trim(),
        client_name: (c.client_name||"").toString().trim(),
        client_code: (c.client_code||"").toString().trim(),
        path: (c.path||"").toString().trim()
      })).filter(c=>c.path && c.client_code);

      // Orden por nombre
      clients.sort((a,b)=>(a.client_name||"").localeCompare((b.client_name||""),"es",{sensitivity:"base"}));

      fillVendorSelect();
      filtered = clients.slice();
      renderMeta();
      applyFilters();

      pillStatus.textContent = "Listo ¬∑ " + clients.length.toLocaleString("es-MX") + " clientes";
    }catch(e){
      pillStatus.textContent = "Error";
      list.innerHTML = `<div class="empty"><b>No pude leer clients.json.</b><br><span class="muted">${escapeHtml(e.message||e)}</span><br><br>Abre ‚ÄúDiagn√≥stico‚Äù.</div>`;
      renderMeta();
      await runDiag(e);
    }
  }

  // Events
  q.addEventListener("input", ()=>applyFilters());
  vendorSel.addEventListener("change", ()=>applyFilters());

  $("btnAll").addEventListener("click", ()=>{
    q.value="";
    vendorSel.value="ALL";
    applyFilters();
  });
  $("btnClear").addEventListener("click", ()=>{
    q.value="";
    applyFilters();
  });
  $("btnDiag").addEventListener("click", ()=>runDiag(null));

  $("btnOpenClientsJson").addEventListener("click", ()=> window.open(base+"clients.json", "_blank"));
  $("btnHardReload").addEventListener("click", ()=>{
    const next = (parseInt(qs.get("v")||"1",10) || 1) + 1;
    location.href = base + "?v=" + next;
  });

  document.querySelectorAll(".tab").forEach(b=>{
    b.addEventListener("click", ()=>setTab(b.dataset.tab));
  });

  // Load!
  load();
})();
</script>
</body>
</html>
